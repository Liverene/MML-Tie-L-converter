<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>MML l코드 자동 변환기</title>
<style>
    body { font-family: sans-serif; padding: 20px; background:#fafafa; }
    textarea { width: 100%; height: 150px; margin-bottom:10px; padding:10px; }
    button { padding: 10px 18px; font-size:16px; cursor:pointer; margin-right:8px; }
</style>
</head>
<body>
<h2>MML l코드 자동 변환기</h2>
<p>
예:  
<code>l4a+l8&a+l16&a+l64&a+</code> →  
<code>l4a+&a+8&a+16&a+64</code>
</p>

<textarea id="input"></textarea>
<br>
<button onclick="convert()">변환하기</button>
<button onclick="clearAll()">지우기</button>
<br>
<textarea id="output"></textarea>

<script>
// 개별 묶음 변환 함수
function convertGroup(group) {
    // 전체를 '&' 기준으로 분리
    const parts = group.split("&");

    // 첫 부분에서 기준 l값 추출 (예: l16d+)
    // <, > 옥타브 표기 포함
    const first = parts[0];

    // 첫 음에서 l값 찾기
    const m = first.match(/l(\d+)/i);
    if (!m) return group; // l값 없으면 그냥 반환

    const baseLen = m[1];  // 예: "16"

    let out = [first];     // 첫 파트는 그대로

    // 이후 파트들 변환
    for (let i = 1; i < parts.length; i++) {
        let p = parts[i];

        // 혹시 lXX가 붙어있다면 제거
        p = p.replace(/l\d+/gi, "");

        // 음표 + 부점 구조 추출
        // 예: d+, d+., g#, f., etc
        const noteMatch = p.match(/^([a-gr][+#-]?)(\.?)/i);
        if (!noteMatch) {
            out.push("&" + p); 
            continue;
        }

        const pitch = noteMatch[1];  // d+, f#, g, etc
        const dot = noteMatch[2] || ""; // . 또는 없음

        // 길이 넣기: pitch + baseLen + dot
        out.push("&" + pitch + baseLen + dot);
    }

    return out.join("");
}

function convert() {
    let text = document.getElementById("input").value;

    // 변환 대상 패턴:
    // l숫자 + 음표(부점/옥타브/기호 포함) + (&음표...) 형태 전부 잡기
    const pattern = /l\d+[><]?[a-gr][+#-]?\.?(?:&[><]?[a-gr][+#-]?\.?)*?/gi;

    let result = text.replace(pattern, (match) => convertGroup(match));

    document.getElementById("output").value = result;
}

function clearAll() {
    document.getElementById("input").value = "";
    document.getElementById("output").value = "";
}
</script>
</body>
</html>